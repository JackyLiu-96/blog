<!DOCTYPE html><html lang="zh-CN" data-theme="light"><head><meta charset="UTF-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width,initial-scale=1"><title>springcloud | 风起の日子</title><meta name="author" content="Jacky Liu"><meta name="copyright" content="Jacky Liu"><meta name="format-detection" content="telephone=no"><meta name="theme-color" content="#ffffff"><meta name="description" content="1. 微服务与微服务架构 微服务是什么  业界大牛马丁.福勒（Martin Fowler） 这样描述微服务： 微服务的概念源于2014年3月Martin Fowler所写的章“Microservices”http:&#x2F;&#x2F;martinfowler.com&#x2F;articles&#x2F;microservices.html 就目前而言，对于微服务业界并没有一个统一的、标信的定义（Whilethere is no p">
<meta property="og:type" content="article">
<meta property="og:title" content="springcloud">
<meta property="og:url" content="https://jackyliu-96.github.io/blog/2021/03/19/springcloud/index.html">
<meta property="og:site_name" content="风起の日子">
<meta property="og:description" content="1. 微服务与微服务架构 微服务是什么  业界大牛马丁.福勒（Martin Fowler） 这样描述微服务： 微服务的概念源于2014年3月Martin Fowler所写的章“Microservices”http:&#x2F;&#x2F;martinfowler.com&#x2F;articles&#x2F;microservices.html 就目前而言，对于微服务业界并没有一个统一的、标信的定义（Whilethere is no p">
<meta property="og:locale" content="zh_CN">
<meta property="og:image" content="https://picsum.photos/id/113/367/267">
<meta property="article:published_time" content="2021-03-19T11:21:15.000Z">
<meta property="article:modified_time" content="2021-03-28T06:53:42.517Z">
<meta property="article:author" content="Jacky Liu">
<meta name="twitter:card" content="summary">
<meta name="twitter:image" content="https://picsum.photos/id/113/367/267"><link rel="shortcut icon" href="/blog/img/favicon.png"><link rel="canonical" href="https://jackyliu-96.github.io/blog/2021/03/19/springcloud/"><link rel="preconnect" href="//cdn.jsdelivr.net"/><link rel="preconnect" href="//busuanzi.ibruce.info"/><link rel="stylesheet" href="/blog/css/index.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free/css/all.min.css" media="print" onload="this.media='all'"><script>const GLOBAL_CONFIG = { 
  root: '/blog/',
  algolia: undefined,
  localSearch: undefined,
  translate: undefined,
  noticeOutdate: undefined,
  highlight: {"plugin":"highlighjs","highlightCopy":true,"highlightLang":true},
  copy: {
    success: '复制成功',
    error: '复制错误',
    noSupport: '浏览器不支持'
  },
  relativeDate: {
    homepage: false,
    post: false
  },
  runtime: '',
  date_suffix: {
    just: '刚刚',
    min: '分钟前',
    hour: '小时前',
    day: '天前',
    month: '个月前'
  },
  copyright: undefined,
  lightbox: 'fancybox',
  Snackbar: undefined,
  source: {
    jQuery: 'https://cdn.jsdelivr.net/npm/jquery@latest/dist/jquery.min.js',
    justifiedGallery: {
      js: 'https://cdn.jsdelivr.net/npm/justifiedGallery/dist/js/jquery.justifiedGallery.min.js',
      css: 'https://cdn.jsdelivr.net/npm/justifiedGallery/dist/css/justifiedGallery.min.css'
    },
    fancybox: {
      js: 'https://cdn.jsdelivr.net/npm/@fancyapps/fancybox@latest/dist/jquery.fancybox.min.js',
      css: 'https://cdn.jsdelivr.net/npm/@fancyapps/fancybox@latest/dist/jquery.fancybox.min.css'
    }
  },
  isPhotoFigcaption: false,
  islazyload: false,
  isanchor: false
}</script><script id="config-diff">var GLOBAL_CONFIG_SITE = { 
  isPost: true,
  isHome: false,
  isHighlightShrink: false,
  isToc: true,
  postUpdate: '2021-03-28 14:53:42'
}</script><noscript><style type="text/css">
  #nav {
    opacity: 1
  }
  .justified-gallery img {
    opacity: 1
  }

  #recent-posts time,
  #post-meta time {
    display: inline !important
  }
</style></noscript><script>(win=>{
    win.saveToLocal = {
      set: function setWithExpiry(key, value, ttl) {
        if (ttl === 0) return
        const now = new Date()
        const expiryDay = ttl * 86400000
        const item = {
          value: value,
          expiry: now.getTime() + expiryDay,
        }
        localStorage.setItem(key, JSON.stringify(item))
      },

      get: function getWithExpiry(key) {
        const itemStr = localStorage.getItem(key)

        if (!itemStr) {
          return undefined
        }
        const item = JSON.parse(itemStr)
        const now = new Date()

        if (now.getTime() > item.expiry) {
          localStorage.removeItem(key)
          return undefined
        }
        return item.value
      }
    }
  
    win.getScript = url => new Promise((resolve, reject) => {
      const script = document.createElement('script')
      script.src = url
      script.async = true
      script.onerror = reject
      script.onload = script.onreadystatechange = function() {
        const loadState = this.readyState
        if (loadState && loadState !== 'loaded' && loadState !== 'complete') return
        script.onload = script.onreadystatechange = null
        resolve()
      }
      document.head.appendChild(script)
    })
  
      win.activateDarkMode = function () {
        document.documentElement.setAttribute('data-theme', 'dark')
        if (document.querySelector('meta[name="theme-color"]') !== null) {
          document.querySelector('meta[name="theme-color"]').setAttribute('content', '#0d0d0d')
        }
      }
      win.activateLightMode = function () {
        document.documentElement.setAttribute('data-theme', 'light')
        if (document.querySelector('meta[name="theme-color"]') !== null) {
          document.querySelector('meta[name="theme-color"]').setAttribute('content', '#ffffff')
        }
      }
      const t = saveToLocal.get('theme')
    
          if (t === 'dark') activateDarkMode()
          else if (t === 'light') activateLightMode()
        
      const asideStatus = saveToLocal.get('aside-status')
      if (asideStatus !== undefined) {
        if (asideStatus === 'hide') {
          document.documentElement.classList.add('hide-aside')
        } else {
          document.documentElement.classList.remove('hide-aside')
        }
      }
    })(window)</script><meta name="generator" content="Hexo 5.3.0"></head><body><div id="sidebar"><div id="menu-mask"></div><div id="sidebar-menus"><div class="author-avatar"><img class="avatar-img" src="https://ss2.bdstatic.com/70cFvnSh_Q1YnxGkpoWK1HF6hhy/it/u=186258224,1724482788&amp;fm=26&amp;gp=0.jpg" onerror="onerror=null;src='/img/friend_404.gif'" alt="avatar"/></div><div class="site-data"><div class="data-item is-center"><div class="data-item-link"><a href="/blog/archives/"><div class="headline">文章</div><div class="length-num">2</div></a></div></div></div><hr/><div class="menus_items"><div class="menus_item"><a class="site-page" href="/blog/"><i class="fa-fw fas fa-home"></i><span> 主页</span></a></div><div class="menus_item"><a class="site-page" href="/blog/archives/"><i class="fa-fw fas fa-archive"></i><span> 归档</span></a></div><div class="menus_item"><a class="site-page" href="/blog/tags/"><i class="fa-fw fas fa-tags"></i><span> 标签</span></a></div><div class="menus_item"><a class="site-page" href="/blog/categories/"><i class="fa-fw fas fa-folder-open"></i><span> 分类</span></a></div><div class="menus_item"><a class="site-page" href="javascript:void(0);"><i class="fa-fw fas fa-list"></i><span> 列表</span><i class="fas fa-chevron-down expand"></i></a><ul class="menus_item_child"><li><a class="site-page" href="/blog/music/"><i class="fa-fw fas fa-music"></i><span> 音乐</span></a></li><li><a class="site-page" href="/blog/movies/"><i class="fa-fw fas fa-video"></i><span> 电影</span></a></li></ul></div><div class="menus_item"><a class="site-page" href="/blog/link/"><i class="fa-fw fas fa-link"></i><span> 友情链接</span></a></div><div class="menus_item"><a class="site-page" href="/blog/about/"><i class="fa-fw fas fa-heart"></i><span> 关于</span></a></div></div></div></div><div class="post" id="body-wrap"><header class="post-bg" id="page-header" style="background-image: url('https://picsum.photos/id/113/367/267')"><nav id="nav"><span id="blog_name"><a id="site-name" href="/blog/">风起の日子</a></span><div id="menus"><div class="menus_items"><div class="menus_item"><a class="site-page" href="/blog/"><i class="fa-fw fas fa-home"></i><span> 主页</span></a></div><div class="menus_item"><a class="site-page" href="/blog/archives/"><i class="fa-fw fas fa-archive"></i><span> 归档</span></a></div><div class="menus_item"><a class="site-page" href="/blog/tags/"><i class="fa-fw fas fa-tags"></i><span> 标签</span></a></div><div class="menus_item"><a class="site-page" href="/blog/categories/"><i class="fa-fw fas fa-folder-open"></i><span> 分类</span></a></div><div class="menus_item"><a class="site-page" href="javascript:void(0);"><i class="fa-fw fas fa-list"></i><span> 列表</span><i class="fas fa-chevron-down expand"></i></a><ul class="menus_item_child"><li><a class="site-page" href="/blog/music/"><i class="fa-fw fas fa-music"></i><span> 音乐</span></a></li><li><a class="site-page" href="/blog/movies/"><i class="fa-fw fas fa-video"></i><span> 电影</span></a></li></ul></div><div class="menus_item"><a class="site-page" href="/blog/link/"><i class="fa-fw fas fa-link"></i><span> 友情链接</span></a></div><div class="menus_item"><a class="site-page" href="/blog/about/"><i class="fa-fw fas fa-heart"></i><span> 关于</span></a></div></div><div id="toggle-menu"><a class="site-page"><i class="fas fa-bars fa-fw"></i></a></div></div></nav><div id="post-info"><h1 class="post-title">springcloud</h1><div id="post-meta"><div class="meta-firstline"><span class="post-meta-date"><i class="far fa-calendar-alt fa-fw post-meta-icon"></i><span class="post-meta-label">发表于</span><time class="post-meta-date-created" datetime="2021-03-19T11:21:15.000Z" title="发表于 2021-03-19 19:21:15">2021-03-19</time><span class="post-meta-separator">|</span><i class="fas fa-history fa-fw post-meta-icon"></i><span class="post-meta-label">更新于</span><time class="post-meta-date-updated" datetime="2021-03-28T06:53:42.517Z" title="更新于 2021-03-28 14:53:42">2021-03-28</time></span></div><div class="meta-secondline"><span class="post-meta-separator">|</span><span class="post-meta-pv-cv"><i class="far fa-eye fa-fw post-meta-icon"></i><span class="post-meta-label">阅读量:</span><span id="busuanzi_value_page_pv"></span></span></div></div></div></header><main class="layout" id="content-inner"><div id="post"><article class="post-content" id="article-container"><h1 id="1-微服务与微服务架构"><a href="#1-微服务与微服务架构" class="headerlink" title="1. 微服务与微服务架构"></a>1. 微服务与微服务架构</h1><ul>
<li>微服务是什么</li>
</ul>
<p>业界大牛马丁.福勒（Martin Fowler） 这样描述微服务：</p>
<p>微服务的概念源于2014年3月Martin Fowler所写的章“Microservices”<a target="_blank" rel="noopener" href="http://martinfowler.com/articles/microservices.html">http://martinfowler.com/articles/microservices.html</a></p>
<p>就目前而言，对于微服务业界并没有一个统一的、标信的定义（Whilethere is no precise definition of this architectural syle）</p>
<ul>
<li><p>In short, the microservice architecturalstyle [1]is an approach to developing a single application as a suite of small services,each running in its own process and communicating with lightweight mechanisms,often an HTTP resource API. These services are built around businesscapabilities and independently deployable by fully automated deploymentmachinery. There is a bare minimum of centralized management of these services,which may be written in different programming languages and use different datastorage technologies.</p>
</li>
<li><p>通常而言，微服务架构是一种架构模式或者说是一种架构风格，它提倡将单一应用程序划分一组小的服务，每个服务运行在其独立的自己的进程中，服务之间互相协调、互相配合，为用户提供最终价值。服务之间采用轻量级的通信机制互相沟通（通常是基于HTTP的RESTful API）。每个服务都围绕着具体业务进行构建，并且能够被独立地部署到生产环境、类生产环境等。另外应尽量避免统一的，集中的服务管理机制，对具体的一个服务而言，应根据业务上下文，选择合适的语言、工具对其进行构建，可以有一个非常轻量级的集中管理来协调这些服务，可以使用不同的语言来编写服务，也可以使用不同的数所存储。</p>
</li>
</ul>
<h1 id="2-服务直接调用"><a href="#2-服务直接调用" class="headerlink" title="2. 服务直接调用"></a>2. 服务直接调用</h1><h2 id="2-1-总体介绍"><a href="#2-1-总体介绍" class="headerlink" title="2.1. 总体介绍"></a>2.1. 总体介绍</h2><ul>
<li><p>承接着我们的springmvc+spring+mybatisplus+mysql课程，以Student模块做一个微服务通用案例Consumer消费者（Client）通过REST调用Provider提供者（Server）提供的服务</p>
</li>
<li><p>直接调用图解如下：</p>
<p><img src="/blog/.io//91.png"></p>
</li>
<li><p>图中，客户端的一个接口，需要调用服务A-N。客户端必须要知道所有服务的网络位置的，以往的做法是配置是配置文件中，或者有些配置在数据库中。这里就带出几个问题：</p>
<ul>
<li>需要配置N个服务的网络位置，加大配置的复杂性</li>
<li>服务的网络位置变化，都需要改变每个调用者的配置</li>
<li>集群的情况下，难以做负载（反向代理的方式除外）</li>
</ul>
</li>
<li><p>总结起来一句话：服务多了，配置很麻烦，问题多多</p>
</li>
</ul>
<h2 id="2-2-创建工程-01-springcloud-direct-parent"><a href="#2-2-创建工程-01-springcloud-direct-parent" class="headerlink" title="2.2. 创建工程 _01_springcloud_direct_parent"></a>2.2. 创建工程 _01_springcloud_direct_parent</h2><h3 id="2-2-1-新建父工程Project"><a href="#2-2-1-新建父工程Project" class="headerlink" title="2.2.1. 新建父工程Project"></a>2.2.1. 新建父工程Project</h3><ul>
<li><p>新建父工程01_springcloud_direct_parent，切记是packaging是pom模式</p>
<p>主要是定义POM文件，将后续各个子模块公用的jar包等统一提出来，类似一个抽象父类</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot;?&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">project</span> <span class="attr">xmlns</span>=<span class="string">&quot;http://maven.apache.org/POM/4.0.0&quot;</span></span></span><br><span class="line"><span class="tag">         <span class="attr">xmlns:xsi</span>=<span class="string">&quot;http://www.w3.org/2001/XMLSchema-instance&quot;</span></span></span><br><span class="line"><span class="tag">         <span class="attr">xsi:schemaLocation</span>=<span class="string">&quot;http://maven.apache.org/POM/4.0.0 http://maven.apache.org/xsd/maven-4.0.0.xsd&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">modelVersion</span>&gt;</span>4.0.0<span class="tag">&lt;/<span class="name">modelVersion</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">&lt;!--current module--&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>net.wanho<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>_001_springcloud_parent<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">version</span>&gt;</span>1.0<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">packaging</span>&gt;</span>pom<span class="tag">&lt;/<span class="name">packaging</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;<span class="name">modules</span>&gt;</span></span><br><span class="line">       <span class="tag">&lt;<span class="name">module</span>&gt;</span>microservice-provider-6001<span class="tag">&lt;/<span class="name">module</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">module</span>&gt;</span>microservice-consumer-7001<span class="tag">&lt;/<span class="name">module</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">modules</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;/<span class="name">project</span>&gt;</span></span><br></pre></td></tr></table></figure>
<h3 id="2-2-2-microservice-provider-6001-服务提供者"><a href="#2-2-2-microservice-provider-6001-服务提供者" class="headerlink" title="2.2.2. microservice-provider-6001 服务提供者"></a>2.2.2. microservice-provider-6001 服务提供者</h3></li>
<li><p>新建 microservice-provider-6001</p>
</li>
<li><p>pom.xml</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">lombok</span><br><span class="line">web</span><br></pre></td></tr></table></figure></li>
<li><p>yml</p>
<figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">server:</span></span><br><span class="line">  <span class="attr">port:</span> <span class="number">6001</span></span><br></pre></td></tr></table></figure></li>
<li><p>主启动类MicroservicecloudProviderApplication.java</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@SpringBootApplication</span></span><br><span class="line"><span class="meta">@RestController</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">MicroserviceProvider6001Application</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</span><br><span class="line">        SpringApplication.run(MicroserviceProvider6001Application.class, args);</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">	<span class="meta">@Value(&quot;$&#123;server.port&#125;&quot;)</span></span><br><span class="line">    <span class="keyword">private</span> String port;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@GetMapping(&quot;/provider&quot;)</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">provider</span><span class="params">()</span></span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="string">&quot;provider&quot;</span>+port;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li>
<li><p>测试</p>
<p><a target="_blank" rel="noopener" href="http://localhost:6001/provider">http://localhost:6001/provider</a></p>
</li>
</ul>
<h3 id="2-2-4-microservice-consumer-7001服务消费者"><a href="#2-2-4-microservice-consumer-7001服务消费者" class="headerlink" title="2.2.4. microservice-consumer-7001服务消费者"></a>2.2.4. microservice-consumer-7001服务消费者</h3><ul>
<li><p>新建 microservice-consumer-7001</p>
</li>
<li><p>POM</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">lombok</span><br><span class="line">web</span><br></pre></td></tr></table></figure></li>
<li><p>yml</p>
<figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">server:</span></span><br><span class="line">  <span class="attr">port:</span> <span class="number">7001</span></span><br></pre></td></tr></table></figure></li>
<li><p>net.wanho.config.MyAppConfig（类似spring里面的applicationContext.xml写入的注入Bean）</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Configuration</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">RestConfig</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Bean</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> RestTemplate <span class="title">getRestTemplate</span><span class="params">()</span></span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> RestTemplate();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li>
<li><p>主启动类 MicroservicecloudConsumerApplication.java</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@SpringBootApplication</span></span><br><span class="line"><span class="meta">@RestController</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">MicroserviceConsumer7001Application</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    <span class="keyword">private</span> RestTemplate restTemplate;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@GetMapping(&quot;/consumer&quot;)</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">consumer</span><span class="params">()</span></span>&#123;</span><br><span class="line">        <span class="comment">//通过rest方式直接调用provider服务，硬编码</span></span><br><span class="line">        String object = restTemplate.getForObject(<span class="string">&quot;http://localhost:6001/provider&quot;</span>, String.class);</span><br><span class="line">        <span class="keyword">return</span> <span class="string">&quot;consumer&quot;</span>+object;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</span><br><span class="line">        SpringApplication.run(MicroserviceConsumer7001Application.class, args);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure></li>
<li><p>测试</p>
<p><a target="_blank" rel="noopener" href="http://localhost:7001/consumer">http://localhost:7001/consumer</a></p>
</li>
</ul>
<h1 id="3-服务通过Eureka服务中心，注册与发现（服务治理）"><a href="#3-服务通过Eureka服务中心，注册与发现（服务治理）" class="headerlink" title="3. 服务通过Eureka服务中心，注册与发现（服务治理）"></a>3. 服务通过Eureka服务中心，注册与发现（服务治理）</h1><h2 id="3-1-服务治理种类"><a href="#3-1-服务治理种类" class="headerlink" title="3.1. 服务治理种类"></a>3.1. 服务治理种类</h2><ul>
<li>要解决直接访问服务的问题，就需要服务注册与发现</li>
</ul>
<p><img src="/blog/.io//92.png"></p>
<ul>
<li><p>与之前一张不同的是，加了个服务发现模块。图比较简单，这边文字描述下。服务A-N把当前自己的网络位置注册到服务发现模块（这里注册的意思就是告诉），服务发现就以K-V的方式记录下，K一般是服务名，V就是IP:PORT。服务发现模块定时的轮询查看这些服务能不能访问的了（这就是健康检查）。客户端在调用服务A-N的时候，就跑去服务发现模块问下它们的网络位置，然后再调用它们的服务。这样的方式是不是就可以解决上面的问题了呢？客户端完全不需要记录这些服务网络位置，客户端和服务端完全解耦！</p>
</li>
<li><p>这个过程大体是这样，当然服务发现模块没这么简单。里面包含的东西还很多。这样表述只是方便理解。</p>
</li>
<li><p>做服务发现的框架常用的有</p>
<ul>
<li>zookeeper (dubbo中用过)</li>
<li>eureka（下面来看）</li>
<li>consul （下下面来看）</li>
<li>etcd （不看啦）</li>
</ul>
</li>
</ul>
<h2 id="3-2-是什么：服务注册中心：Eureka"><a href="#3-2-是什么：服务注册中心：Eureka" class="headerlink" title="3.2. 是什么：服务注册中心：Eureka"></a>3.2. 是什么：服务注册中心：Eureka</h2><p><img src="/blog/.io//20.png" alt="image-20190318095230610"></p>
<p>Spring Cloud Eureka来实现服务治理。</p>
<ul>
<li><p><img src="/blog/.io//3.png" alt="1. 服务注册于发现.png"></p>
</li>
<li><p>Eureka Server 提供服务注册和发现</p>
</li>
<li><p>Service Provider服务提供方将自身服务注册到Eureka，从而向Server提供服务</p>
</li>
<li><p>Service Consumer服务发现方将服务从Eureka，从而使用向Server获取服务</p>
</li>
</ul>
<h2 id="3-3-创建工程-02-springcloud-eureka-parent"><a href="#3-3-创建工程-02-springcloud-eureka-parent" class="headerlink" title="3.3. 创建工程 _02_springcloud_eureka_parent"></a>3.3. 创建工程 _02_springcloud_eureka_parent</h2><h3 id="3-3-1-新建eureka-server-5001"><a href="#3-3-1-新建eureka-server-5001" class="headerlink" title="3.3.1. 新建eureka-server-5001"></a>3.3.1. 新建eureka-server-5001</h3><ul>
<li><h3 id="三步曲"><a href="#三步曲" class="headerlink" title="三步曲"></a>三步曲</h3><ul>
<li><p>pom</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.cloud<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-cloud-starter-netflix-eureka-server<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br></pre></td></tr></table></figure></li>
<li><p>@EnableEurekaServer注解</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@EnableEurekaServer</span></span><br></pre></td></tr></table></figure></li>
<li><p>yml</p>
<p>在默认设置下，该服务注册中心也会将自己作为客户端来尝试注册它自己，所以我们需要禁用它的客户端注册行为，只需要在<code>application.yml</code>配置文件中增加如下信息：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">registerWithEureka: false</span><br><span class="line">fetchRegistry: false</span><br></pre></td></tr></table></figure>
<figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">server:</span></span><br><span class="line">  <span class="attr">port:</span> <span class="number">5001</span></span><br><span class="line"><span class="attr">eureka:</span></span><br><span class="line">  <span class="attr">instance:</span></span><br><span class="line">    <span class="attr">hostname:</span> <span class="string">localhost</span></span><br><span class="line">  <span class="attr">client:</span></span><br><span class="line"><span class="comment">#    eureka服务不需要 注册到eureka服务中心</span></span><br><span class="line">    <span class="attr">register-with-eureka:</span> <span class="literal">false</span></span><br><span class="line"><span class="comment">#    不获取</span></span><br><span class="line">    <span class="attr">fetch-registry:</span> <span class="literal">false</span></span><br><span class="line"><span class="comment">#    注册地址</span></span><br><span class="line">    <span class="attr">service-url:</span></span><br><span class="line">      <span class="attr">defaultZone:</span> <span class="string">http://$&#123;eureka.instance.hostname&#125;:$&#123;server.port&#125;/eureka/</span></span><br></pre></td></tr></table></figure>
<h3 id><a href="#" class="headerlink" title></a></h3></li>
</ul>
</li>
</ul>
<h3 id="3-3-2-新建eureka-provider-6001"><a href="#3-3-2-新建eureka-provider-6001" class="headerlink" title="3.3.2. 新建eureka-provider-6001"></a>3.3.2. 新建eureka-provider-6001</h3><ul>
<li><h3 id="三步曲-1"><a href="#三步曲-1" class="headerlink" title="三步曲"></a>三步曲</h3><ul>
<li><p>pom</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.cloud<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-cloud-starter-netflix-eureka-client<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br></pre></td></tr></table></figure></li>
<li><p>@EnableEurekaClient或@EnableDiscoveryClient注解</p>
<p>在应用主类中通过加上 @EnableEurekaClient，但只有Eureka 可用，你也可以使用@EnableDiscoveryClient。需要配置才能找到Eureka注册中心服务器</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@EnableEurekaClient</span></span><br><span class="line"><span class="comment">//或</span></span><br><span class="line"><span class="meta">@EnableDiscoveryClient</span></span><br></pre></td></tr></table></figure>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@SpringBootApplication</span></span><br><span class="line"><span class="meta">@EnableEurekaClient</span></span><br><span class="line"><span class="meta">@RestController</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">EurekaProvider6001Application</span> </span>&#123;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="meta">@Value(&quot;$&#123;server.port&#125;&quot;)</span></span><br><span class="line">    <span class="keyword">private</span> String port;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@GetMapping(&quot;/provider&quot;)</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">provider</span><span class="params">()</span></span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="string">&quot;provider&quot;</span>+port;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</span><br><span class="line">        SpringApplication.run(EurekaProvider6001Application.class, args);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>

</li>
<li><p>yml</p>
<figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">server:</span></span><br><span class="line">  <span class="attr">port:</span> <span class="number">6001</span></span><br><span class="line"><span class="attr">eureka:</span></span><br><span class="line">  <span class="attr">client:</span></span><br><span class="line">    <span class="attr">service-url:</span></span><br><span class="line">      <span class="attr">defaultZone:</span> <span class="string">http://localhost:5001/eureka/</span></span><br><span class="line">  <span class="attr">instance:</span></span><br><span class="line"><span class="comment">#    显示ip</span></span><br><span class="line">    <span class="attr">prefer-ip-address:</span> <span class="literal">true</span></span><br><span class="line"><span class="comment">#    Status显示名</span></span><br><span class="line">    <span class="attr">instance-id:</span> <span class="string">eureka-provider-6001</span></span><br><span class="line"><span class="attr">spring:</span></span><br><span class="line">  <span class="attr">application:</span></span><br><span class="line"><span class="comment">#    Application名称，只能用中划杠</span></span><br><span class="line">    <span class="attr">name:</span> <span class="string">eureka-provider</span></span><br></pre></td></tr></table></figure>

</li>
</ul>
</li>
</ul>
<h3 id="3-3-3-新建eureka-consumer-7001"><a href="#3-3-3-新建eureka-consumer-7001" class="headerlink" title="3.3.3. 新建eureka-consumer-7001"></a>3.3.3. 新建eureka-consumer-7001</h3><ul>
<li><h3 id="三步曲-2"><a href="#三步曲-2" class="headerlink" title="三步曲"></a>三步曲</h3><ul>
<li><p>pom</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"> <span class="comment">&lt;!--eureka 它里包含了rabbion--&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.cloud<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-cloud-starter-netflix-eureka-client<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">version</span>&gt;</span>2.1.1.RELEASE<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br></pre></td></tr></table></figure></li>
<li><p>注解@EnableEurekaClient</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@SpringBootApplication</span></span><br><span class="line"><span class="meta">@EnableEurekaClient</span></span><br><span class="line"><span class="meta">@RestController</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">EurekaConsumer7001Application</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    <span class="keyword">private</span> RestTemplate restTemplate;</span><br><span class="line"></span><br><span class="line">    String prefiex=<span class="string">&quot;http://EUREKA-PROVIDER&quot;</span>;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@GetMapping(&quot;/consumer&quot;)</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">consumer</span><span class="params">()</span></span>&#123;</span><br><span class="line">        <span class="comment">//通过rest方式直接调用provider服务，硬编码</span></span><br><span class="line">        String object = restTemplate.getForObject(prefiex+<span class="string">&quot;/provider&quot;</span>, String.class);</span><br><span class="line">        <span class="keyword">return</span> <span class="string">&quot;consumer&quot;</span>+object;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</span><br><span class="line">        SpringApplication.run(EurekaConsumer7001Application.class, args);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li>
<li><p>yml</p>
<figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">server:</span></span><br><span class="line">  <span class="attr">port:</span> <span class="number">7001</span></span><br><span class="line">  <span class="attr">servlet:</span></span><br><span class="line">    <span class="attr">context-path:</span> <span class="string">/</span></span><br><span class="line"><span class="attr">eureka:</span></span><br><span class="line">  <span class="attr">client:</span></span><br><span class="line">    <span class="attr">service-url:</span></span><br><span class="line">      <span class="attr">defaultZone:</span> <span class="string">http://localhost:5000/eureka/</span></span><br><span class="line">    <span class="attr">register-with-eureka:</span> <span class="literal">false</span></span><br><span class="line"></span><br></pre></td></tr></table></figure></li>
<li><p>创建RestTemplate</p>
<ul>
<li>必须使用@LoadBalanced注解 </li>
</ul>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Bean</span></span><br><span class="line"><span class="meta">@LoadBalanced</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> RestTemplate <span class="title">getRestTemplate</span><span class="params">()</span></span>&#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">new</span> RestTemplate();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="3-3-4-在注册中心点服务显示信息"><a href="#3-3-4-在注册中心点服务显示信息" class="headerlink" title="3.3.4. 在注册中心点服务显示信息"></a>3.3.4. 在注册中心点服务显示信息</h3></li>
</ul>
</li>
<li><p>默认点击服务后跳转至此路径  <a target="_blank" rel="noopener" href="http://localhost:6001/actuator/info%EF%BC%8C%E9%A1%B5%E9%9D%A2%E6%9F%A5%E7%9C%8B%E4%B8%8D%E5%88%B0%E5%86%85%E5%AE%B9">http://localhost:6001/actuator/info，页面查看不到内容</a></p>
</li>
<li><p>如果想查看内容，如下操作</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-starter-actuator<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br></pre></td></tr></table></figure></li>
<li><p>application.yml</p>
<figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">server:</span></span><br><span class="line">  <span class="attr">port:</span> <span class="number">6001</span></span><br><span class="line"><span class="attr">eureka:</span></span><br><span class="line">  <span class="attr">client:</span></span><br><span class="line">    <span class="attr">service-url:</span></span><br><span class="line">      <span class="attr">defaultZone:</span> <span class="string">http://localhost:5000/eureka/</span></span><br><span class="line">  <span class="attr">instance:</span></span><br><span class="line">    <span class="comment">#    显示ip</span></span><br><span class="line">    <span class="attr">prefer-ip-address:</span> <span class="literal">true</span></span><br><span class="line">    <span class="comment">#    Status显示名</span></span><br><span class="line">    <span class="attr">instance-id:</span> <span class="string">eureka-provider-6001</span></span><br><span class="line">    <span class="comment">#需要增加下面配置，告诉注册中心访问路径变化</span></span><br><span class="line">    <span class="attr">status-page-url-path:</span> <span class="string">/actuator/info</span></span><br><span class="line">    <span class="attr">health-check-url-path:</span> <span class="string">/actuator/health</span></span><br><span class="line"><span class="attr">spring:</span></span><br><span class="line">  <span class="attr">application:</span></span><br><span class="line">    <span class="comment">#    Application名称</span></span><br><span class="line">    <span class="attr">name:</span> <span class="string">eureka-provider</span></span><br><span class="line"></span><br><span class="line"><span class="attr">management:</span></span><br><span class="line">  <span class="attr">server:</span></span><br><span class="line">  <span class="comment">#actuator端口</span></span><br><span class="line">  <span class="comment">#    port: 9001</span></span><br><span class="line">  <span class="attr">endpoints:</span></span><br><span class="line">    <span class="attr">web:</span></span><br><span class="line">      <span class="comment">#修改访问路径  2.0之前默认是/   2.0默认是 /actuator  可以通过这个属性值修改</span></span><br><span class="line">      <span class="attr">base-path:</span> <span class="string">/actuator</span></span><br><span class="line">      <span class="attr">exposure:</span></span><br><span class="line">        <span class="attr">include:</span> <span class="string">&#x27;*&#x27;</span></span><br><span class="line">  <span class="attr">endpoint:</span></span><br><span class="line">    <span class="attr">health:</span></span><br><span class="line">      <span class="comment">#显示健康具体信息  默认不会显示详细信息</span></span><br><span class="line">      <span class="attr">show-details:</span> <span class="string">always</span></span><br><span class="line"><span class="attr">info:</span></span><br><span class="line">  <span class="attr">appName:</span> <span class="string">eureka-provider-6001</span></span><br><span class="line">  <span class="attr">companyName:</span> <span class="string">www.wanho.net</span></span><br></pre></td></tr></table></figure>
<h1 id="4-Feign-调用服务，面向接口-还不是面向URL"><a href="#4-Feign-调用服务，面向接口-还不是面向URL" class="headerlink" title="4.  Feign 调用服务，面向接口 还不是面向URL"></a>4.  Feign 调用服务，面向接口 还不是面向URL</h1></li>
</ul>
<h2 id="4-1-概述"><a href="#4-1-概述" class="headerlink" title="4.1. 概述"></a>4.1. 概述</h2><h3 id="4-1-1-读音"><a href="#4-1-1-读音" class="headerlink" title="4.1.1. 读音"></a>4.1.1. 读音</h3><p><img src="/blog/.io//23.png" alt="image-20190318102452423"></p>
<h3 id="4-1-2-什么是Feign？"><a href="#4-1-2-什么是Feign？" class="headerlink" title="4.1.2. 什么是Feign？"></a>4.1.2. 什么是Feign？</h3><ul>
<li>Feign是一个声明式的Web服务客户端，使得编写Web服务客户端变得非常容易，只需要创建一个接口，然后在上面添加注解即可</li>
<li>Spring Cloud 集成 Ribbon 和 Eureka 提供的负载均衡的HTTP客户端 ，而Feign也集成了Ribbon</li>
<li>Spring Cloud Netflix 官网文档<a target="_blank" rel="noopener" href="http://www.xyuu.cn/spring-cloud-netflix-zhcn.html">http://www.xyuu.cn/spring-cloud-netflix-zhcn.html</a></li>
</ul>
<h2 id="4-2-引出三种方式"><a href="#4-2-引出三种方式" class="headerlink" title="4.2. 引出三种方式"></a>4.2. 引出三种方式</h2><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//直接调用 </span></span><br><span class="line"><span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> String url=<span class="string">&quot;http://localhost:7001/provider&quot;</span>;</span><br><span class="line">restTemplate.getForObject(url,String.class)</span><br><span class="line">    </span><br><span class="line"><span class="comment">//通过服务名调用 </span></span><br><span class="line"><span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> String url=<span class="string">&quot;http://EUREKA-PROVIDER/provider&quot;</span>;</span><br><span class="line">restTemplate.getForObject(url,String.class)</span><br><span class="line">    </span><br><span class="line"><span class="comment">//通过接口调用 </span></span><br><span class="line"><span class="meta">@FeignClient(&quot;EUREKA-PROVIDER&quot;)</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">interface</span> <span class="title">ProviderClient</span> </span>&#123;</span><br><span class="line">    <span class="meta">@GetMapping(&quot;/provider&quot;)</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">provider</span><span class="params">()</span></span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h2 id="4-3-新建-03-springlcoud-fegin-parent的maven父工程"><a href="#4-3-新建-03-springlcoud-fegin-parent的maven父工程" class="headerlink" title="4.3. 新建_03_springlcoud_fegin_parent的maven父工程"></a>4.3. 新建_03_springlcoud_fegin_parent的maven父工程</h2><p>把之前的03_springlcoud_ribbon_parent项目复制过来</p>
<ul>
<li><p>eureka-server-5001不变</p>
</li>
<li><p>eureka-provider-6001 不变</p>
</li>
</ul>
<ul>
<li><p>eureka-consumer-7001修改</p>
</li>
<li><p>fegin使用三步曲</p>
<ul>
<li><p>pom.xml</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.cloud<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-cloud-starter-openfeign<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br></pre></td></tr></table></figure></li>
<li><p>@EnableFeignClients</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line">@SpringBootApplication</span><br><span class="line">@EnableEurekaClient</span><br><span class="line">@EnableFeignClients</span><br><span class="line">@RestController</span><br><span class="line">public class EurekaConsumerFegin7001Application &#123;</span><br><span class="line"></span><br><span class="line">    @Autowired</span><br><span class="line">    private ProviderClient providerClient;</span><br><span class="line"></span><br><span class="line">    @GetMapping(&quot;/consumer&quot;)</span><br><span class="line">    public String consumer()&#123;</span><br><span class="line">        //通过feign调用provider服务</span><br><span class="line">        String object = providerClient.getProvider();</span><br><span class="line">        return &quot;consumer&quot;+object;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    public static void main(String[] args) &#123;</span><br><span class="line">        SpringApplication.run(EurekaConsumerFegin7001Application.class, args);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li>
<li><p>@FeignClient</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@FeignClient(&quot;EUREKA-PROVIDER&quot;)</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">interface</span> <span class="title">ProviderClient</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@GetMapping(&quot;/provider&quot;)</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">getProvider</span><span class="params">()</span></span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<h1 id="5-Ribbon负载均衡"><a href="#5-Ribbon负载均衡" class="headerlink" title="5.  Ribbon负载均衡"></a>5.  Ribbon负载均衡</h1></li>
</ul>
</li>
</ul>
<h2 id="5-1-概述"><a href="#5-1-概述" class="headerlink" title="5.1. 概述"></a>5.1. 概述</h2><ul>
<li><p>是什么</p>
<ul>
<li>Spring Cloud Ribbon是基于Netflix Ribbon实现的一套客户端负载均衡的工具。</li>
</ul>
</li>
<li><p>pom.xml ,<strong>也可以不需要下载</strong>，因为eureka中已经集成了ribbon,且Feign也集成ribbon</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!--ribbon--&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.cloud<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-cloud-starter-ribbon<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">version</span>&gt;</span>1.2.6.RELEASE<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br></pre></td></tr></table></figure>
<h2 id="5-2-示例工程-02-springcloud-eureka-parent"><a href="#5-2-示例工程-02-springcloud-eureka-parent" class="headerlink" title="5.2. 示例工程 _02_springcloud_eureka_parent"></a>5.2. 示例工程 _02_springcloud_eureka_parent</h2></li>
<li><p>eureka-server-5001不变</p>
</li>
<li><p>eureka-consumer-7001不变</p>
</li>
<li><p>microservice-provider-6001 不变，但复制</p>
</li>
<li><p>microservice-provider-6002 =&gt;shift+f6=&gt;修改模块名=&gt;pom.xml名称=&gt;yml端口号和status的名字</p>
</li>
<li><p>观察发现consumer是轮询的方式访问provider</p>
</li>
</ul>
<h2 id="5-3-Ribbon核心组件IRule"><a href="#5-3-Ribbon核心组件IRule" class="headerlink" title="5.3. Ribbon核心组件IRule"></a>5.3. Ribbon核心组件IRule</h2><h4 id="5-3-1-Ribbon负载均衡算法"><a href="#5-3-1-Ribbon负载均衡算法" class="headerlink" title="5.3.1. Ribbon负载均衡算法"></a>5.3.1. Ribbon负载均衡算法</h4><p>Ribbon默认提供的是轮询的负载均衡算法，完整了还有如下</p>
<table>
<thead>
<tr>
<th>名称</th>
<th>说明</th>
</tr>
</thead>
<tbody><tr>
<td>RoundRobinRule</td>
<td>轮询</td>
</tr>
<tr>
<td>RandomRule</td>
<td>随机</td>
</tr>
<tr>
<td>AvaliabilityFilteringRule</td>
<td>会先过滤由于多次访问故障而处于断路器跳闸的状态的服务和并发的连接数量超过阈值的服务，然后对剩余的服务列表按照轮询策略</td>
</tr>
<tr>
<td>WeightedResponseTimeRule</td>
<td>根据平均响应时间计算所有服务的权重，响应时间越快服务权重越大</td>
</tr>
<tr>
<td>RetryRule</td>
<td>先按照RoundRobinRule策略获取服务，如果获取服务失败会在指定时间内重试</td>
</tr>
<tr>
<td>BestAvailableRule</td>
<td>会先过滤掉由于多次访问故障二处于断路器跳闸状态的服务，然后选择一个并发量最小的服务</td>
</tr>
<tr>
<td>ZoneAvoidanceRule</td>
<td>默认规则，复合判断server所在的区域的性能和server的可用性选择服务器</td>
</tr>
</tbody></table>
<h4 id="5-3-2-Ribbon负载均衡算法使用方法"><a href="#5-3-2-Ribbon负载均衡算法使用方法" class="headerlink" title="5.3.2. Ribbon负载均衡算法使用方法"></a>5.3.2. Ribbon负载均衡算法使用方法</h4><p>在客户端的配置类ConfigBean.java中添加IRule的实现</p>
<p>1、配置轮询的负载均衡算法</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Configuration</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">RestConfig</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Bean</span></span><br><span class="line">    <span class="meta">@LoadBalanced</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> RestTemplate <span class="title">getRestTemplate</span><span class="params">()</span></span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> RestTemplate();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Bean</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> IRule <span class="title">getRule</span><span class="params">()</span></span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> RandomRule();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<h2 id="5-4-同一个项目，启动多次-status-port值不一样"><a href="#5-4-同一个项目，启动多次-status-port值不一样" class="headerlink" title="5.4. 同一个项目，启动多次(status,port值不一样)"></a>5.4. 同一个项目，启动多次(status,port值不一样)</h2><p><img src="/blog/.io//QQ%E6%88%AA%E5%9B%BE20191115162436.png"></p>
<h1 id="6-高可用Eureka-Server环境搭建"><a href="#6-高可用Eureka-Server环境搭建" class="headerlink" title="6.  高可用Eureka-Server环境搭建"></a>6.  高可用Eureka-Server环境搭建</h1><p>Eureka Server 高可用环境需要部署两个Eureka server，它们互相向对方注册。如果在本机启动两个Eureka需要 注意两个Eureka Server的端口要设置不一样，这里我们部署一个Eureka Server工程，将端口可配置，制作两个 Eureka Server启动脚本，启动不同的端口，如下图：</p>
<p><img src="/blog/.io//springcloud%5Cimage5.png"></p>
<p>1、在实际使用时Eureka Server至少部署两台服务器，实现高可用。 </p>
<p>2、两台Eureka Server互相注册。</p>
<p>3、微服务需要连接两台Eureka Server注册，当其中一台Eureka死掉也不会影响服务的注册与发现。</p>
<p>4、微服务会定时向Eureka server发送心跳，报告自己的状态。</p>
<p> 5、微服务从注册中心获取服务地址以RESTful方式发起远程调用。 配置如下：</p>
<p>1、端口可配置</p>
<figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">server:</span></span><br><span class="line">  <span class="attr">port:</span> <span class="string">$&#123;PORT:5001&#125;</span> <span class="comment">#服务端口</span></span><br></pre></td></tr></table></figure>
<p>2、Eureka服务端的交互地址可配置</p>
<figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">eureka:</span></span><br><span class="line">  <span class="attr">client:</span></span><br><span class="line">    <span class="attr">registerWithEureka:</span> <span class="literal">true</span> <span class="comment">#服务注册，是否将自己注册到Eureka服务中</span></span><br><span class="line">    <span class="attr">fetchRegistry:</span> <span class="literal">true</span> <span class="comment">#服务发现，是否从Eureka中获取注册信息</span></span><br><span class="line">    <span class="attr">serviceUrl:</span> <span class="comment">#Eureka客户端与Eureka服务端的交互地址，高可用状态配置对方的地址，单机状态配置自己（如果不配置则默认本机8761端口）</span></span><br><span class="line">      <span class="attr">defaultZone:</span> <span class="string">$&#123;EUREKA_SERVER:http://eureka02:5002/eureka/&#125;</span></span><br></pre></td></tr></table></figure>
<p>3、配置hostname</p>
<ul>
<li><p>Eureka 组成高可用，两个Eureka互相向对方注册，这里需要通过域名或主机名访问，这里我们设置两个Eureka服 务的主机名分别为 eureka01、eureka02。</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="number">127.0</span><span class="number">.0</span><span class="number">.1</span> eureka01</span><br><span class="line"><span class="number">127.0</span><span class="number">.0</span><span class="number">.1</span> eureka02</span><br></pre></td></tr></table></figure>
<p>完整的eureka配置如下：</p>
</li>
</ul>
<figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">eureka:</span></span><br><span class="line">  <span class="attr">client:</span></span><br><span class="line">    <span class="attr">registerWithEureka:</span> <span class="literal">true</span> <span class="comment">#服务注册，是否将自己注册到Eureka服务中</span></span><br><span class="line">    <span class="attr">fetchRegistry:</span> <span class="literal">true</span> <span class="comment">#服务发现，是否从Eureka中获取注册信息</span></span><br><span class="line">    <span class="attr">serviceUrl:</span> <span class="comment">#Eureka客户端与Eureka服务端的交互地址，高可用状态配置对方的地址，单机状态配置自己（如果不配置则默认本机8761端口）</span></span><br><span class="line">      <span class="attr">defaultZone:</span> <span class="string">$&#123;EUREKA_SERVER:http://eureka02:5002/eureka/&#125;</span></span><br><span class="line">  <span class="attr">server:</span></span><br><span class="line">    <span class="attr">enable-self-preservation:</span> <span class="literal">false</span> <span class="comment">#是否开启自我保护模式</span></span><br><span class="line">    <span class="attr">eviction-interval-timer-in-ms:</span> <span class="number">60000</span> <span class="comment">#服务注册表清理间隔（单位毫秒，默认是60*1000）</span></span><br><span class="line">  <span class="attr">instance:</span></span><br><span class="line">    <span class="attr">hostname:</span> <span class="string">$&#123;EUREKA_DOMAIN:eureka01&#125;</span></span><br></pre></td></tr></table></figure>
<p>4、在IDEA中制作启动脚本 启动1：</p>
<p>启动2：</p>
<p> <img src="/blog/.io//springcloud%5Cimage7.png"></p>
<p>运行两个启动脚本，分别浏览：</p>
<p><a target="_blank" rel="noopener" href="http://localhost:50101/">http://localhost:50101/</a></p>
<p><a target="_blank" rel="noopener" href="http://localhost:50102/">http://localhost:50102/</a></p>
<p>Eureka主画面如下：</p>
<p><img src="/blog/.io//springcloud%5CQQ20191009-063706@2x.png"></p>
<h1 id="-1"><a href="#-1" class="headerlink" title></a></h1><h1 id="-2"><a href="#-2" class="headerlink" title></a></h1></article><div class="post-copyright"><div class="post-copyright__author"><span class="post-copyright-meta">文章作者: </span><span class="post-copyright-info"><a href="mailto:undefined">Jacky Liu</a></span></div><div class="post-copyright__type"><span class="post-copyright-meta">文章链接: </span><span class="post-copyright-info"><a href="https://jackyliu-96.github.io/blog/2021/03/19/springcloud/">https://jackyliu-96.github.io/blog/2021/03/19/springcloud/</a></span></div><div class="post-copyright__notice"><span class="post-copyright-meta">版权声明: </span><span class="post-copyright-info">本博客所有文章除特别声明外，均采用 <a href="https://creativecommons.org/licenses/by-nc-sa/4.0/" target="_blank">CC BY-NC-SA 4.0</a> 许可协议。转载请注明来自 <a href="https://jackyliu-96.github.io/blog" target="_blank">风起の日子</a>！</span></div></div><div class="tag_share"><div class="post-meta__tag-list"></div><div class="post_share"><div class="social-share" data-image="https://picsum.photos/id/113/367/267" data-sites="facebook,twitter,wechat,weibo,qq"></div><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/social-share.js/dist/css/share.min.css" media="print" onload="this.media='all'"><script src="https://cdn.jsdelivr.net/npm/social-share.js/dist/js/social-share.min.js" defer></script></div></div><div class="post-reward"><div class="reward-button button--animated"><i class="fas fa-qrcode"></i> 打赏</div><div class="reward-main"><ul class="reward-all"><li class="reward-item"><a href="/blog/img/wechat.jpg" target="_blank"><img class="post-qr-code-img" src="/blog/img/wechat.jpg" alt="wechat"/></a><div class="post-qr-code-desc">wechat</div></li><li class="reward-item"><a href="/blog/img/alipay.jpg" target="_blank"><img class="post-qr-code-img" src="/blog/img/alipay.jpg" alt="alipay"/></a><div class="post-qr-code-desc">alipay</div></li></ul></div></div><nav class="pagination-post" id="pagination"><div class="next-post pull-full"><a href="/blog/2021/02/04/hello-world/"><img class="next-cover" src="https://cdn.jsdelivr.net/npm/butterfly-extsrc@1/img/default.jpg" onerror="onerror=null;src='/blog/img/404.jpg'" alt="cover of next post"><div class="pagination-info"><div class="label">下一篇</div><div class="next_info">Hello World</div></div></a></div></nav></div><div class="aside-content" id="aside-content"><div class="sticky_layout"><div class="card-widget" id="card-toc"><div class="item-headline"><i class="fas fa-stream"></i><span>目录</span></div><div class="toc-content"><ol class="toc"><li class="toc-item toc-level-1"><a class="toc-link" href="#1-%E5%BE%AE%E6%9C%8D%E5%8A%A1%E4%B8%8E%E5%BE%AE%E6%9C%8D%E5%8A%A1%E6%9E%B6%E6%9E%84"><span class="toc-number">1.</span> <span class="toc-text">1. 微服务与微服务架构</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#2-%E6%9C%8D%E5%8A%A1%E7%9B%B4%E6%8E%A5%E8%B0%83%E7%94%A8"><span class="toc-number">2.</span> <span class="toc-text">2. 服务直接调用</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#2-1-%E6%80%BB%E4%BD%93%E4%BB%8B%E7%BB%8D"><span class="toc-number">2.1.</span> <span class="toc-text">2.1. 总体介绍</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#2-2-%E5%88%9B%E5%BB%BA%E5%B7%A5%E7%A8%8B-01-springcloud-direct-parent"><span class="toc-number">2.2.</span> <span class="toc-text">2.2. 创建工程 _01_springcloud_direct_parent</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#2-2-1-%E6%96%B0%E5%BB%BA%E7%88%B6%E5%B7%A5%E7%A8%8BProject"><span class="toc-number">2.2.1.</span> <span class="toc-text">2.2.1. 新建父工程Project</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#2-2-2-microservice-provider-6001-%E6%9C%8D%E5%8A%A1%E6%8F%90%E4%BE%9B%E8%80%85"><span class="toc-number">2.2.2.</span> <span class="toc-text">2.2.2. microservice-provider-6001 服务提供者</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#2-2-4-microservice-consumer-7001%E6%9C%8D%E5%8A%A1%E6%B6%88%E8%B4%B9%E8%80%85"><span class="toc-number">2.2.3.</span> <span class="toc-text">2.2.4. microservice-consumer-7001服务消费者</span></a></li></ol></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#3-%E6%9C%8D%E5%8A%A1%E9%80%9A%E8%BF%87Eureka%E6%9C%8D%E5%8A%A1%E4%B8%AD%E5%BF%83%EF%BC%8C%E6%B3%A8%E5%86%8C%E4%B8%8E%E5%8F%91%E7%8E%B0%EF%BC%88%E6%9C%8D%E5%8A%A1%E6%B2%BB%E7%90%86%EF%BC%89"><span class="toc-number">3.</span> <span class="toc-text">3. 服务通过Eureka服务中心，注册与发现（服务治理）</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#3-1-%E6%9C%8D%E5%8A%A1%E6%B2%BB%E7%90%86%E7%A7%8D%E7%B1%BB"><span class="toc-number">3.1.</span> <span class="toc-text">3.1. 服务治理种类</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#3-2-%E6%98%AF%E4%BB%80%E4%B9%88%EF%BC%9A%E6%9C%8D%E5%8A%A1%E6%B3%A8%E5%86%8C%E4%B8%AD%E5%BF%83%EF%BC%9AEureka"><span class="toc-number">3.2.</span> <span class="toc-text">3.2. 是什么：服务注册中心：Eureka</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#3-3-%E5%88%9B%E5%BB%BA%E5%B7%A5%E7%A8%8B-02-springcloud-eureka-parent"><span class="toc-number">3.3.</span> <span class="toc-text">3.3. 创建工程 _02_springcloud_eureka_parent</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#3-3-1-%E6%96%B0%E5%BB%BAeureka-server-5001"><span class="toc-number">3.3.1.</span> <span class="toc-text">3.3.1. 新建eureka-server-5001</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E4%B8%89%E6%AD%A5%E6%9B%B2"><span class="toc-number">3.3.2.</span> <span class="toc-text">三步曲</span></a></li><li class="toc-item toc-level-3"><a class="toc-link"><span class="toc-number">3.3.3.</span> <span class="toc-text"></span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#3-3-2-%E6%96%B0%E5%BB%BAeureka-provider-6001"><span class="toc-number">3.3.4.</span> <span class="toc-text">3.3.2. 新建eureka-provider-6001</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E4%B8%89%E6%AD%A5%E6%9B%B2-1"><span class="toc-number">3.3.5.</span> <span class="toc-text">三步曲</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#3-3-3-%E6%96%B0%E5%BB%BAeureka-consumer-7001"><span class="toc-number">3.3.6.</span> <span class="toc-text">3.3.3. 新建eureka-consumer-7001</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E4%B8%89%E6%AD%A5%E6%9B%B2-2"><span class="toc-number">3.3.7.</span> <span class="toc-text">三步曲</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#3-3-4-%E5%9C%A8%E6%B3%A8%E5%86%8C%E4%B8%AD%E5%BF%83%E7%82%B9%E6%9C%8D%E5%8A%A1%E6%98%BE%E7%A4%BA%E4%BF%A1%E6%81%AF"><span class="toc-number">3.3.8.</span> <span class="toc-text">3.3.4. 在注册中心点服务显示信息</span></a></li></ol></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#4-Feign-%E8%B0%83%E7%94%A8%E6%9C%8D%E5%8A%A1%EF%BC%8C%E9%9D%A2%E5%90%91%E6%8E%A5%E5%8F%A3-%E8%BF%98%E4%B8%8D%E6%98%AF%E9%9D%A2%E5%90%91URL"><span class="toc-number">4.</span> <span class="toc-text">4.  Feign 调用服务，面向接口 还不是面向URL</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#4-1-%E6%A6%82%E8%BF%B0"><span class="toc-number">4.1.</span> <span class="toc-text">4.1. 概述</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#4-1-1-%E8%AF%BB%E9%9F%B3"><span class="toc-number">4.1.1.</span> <span class="toc-text">4.1.1. 读音</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#4-1-2-%E4%BB%80%E4%B9%88%E6%98%AFFeign%EF%BC%9F"><span class="toc-number">4.1.2.</span> <span class="toc-text">4.1.2. 什么是Feign？</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#4-2-%E5%BC%95%E5%87%BA%E4%B8%89%E7%A7%8D%E6%96%B9%E5%BC%8F"><span class="toc-number">4.2.</span> <span class="toc-text">4.2. 引出三种方式</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#4-3-%E6%96%B0%E5%BB%BA-03-springlcoud-fegin-parent%E7%9A%84maven%E7%88%B6%E5%B7%A5%E7%A8%8B"><span class="toc-number">4.3.</span> <span class="toc-text">4.3. 新建_03_springlcoud_fegin_parent的maven父工程</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#5-Ribbon%E8%B4%9F%E8%BD%BD%E5%9D%87%E8%A1%A1"><span class="toc-number">5.</span> <span class="toc-text">5.  Ribbon负载均衡</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#5-1-%E6%A6%82%E8%BF%B0"><span class="toc-number">5.1.</span> <span class="toc-text">5.1. 概述</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#5-2-%E7%A4%BA%E4%BE%8B%E5%B7%A5%E7%A8%8B-02-springcloud-eureka-parent"><span class="toc-number">5.2.</span> <span class="toc-text">5.2. 示例工程 _02_springcloud_eureka_parent</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#5-3-Ribbon%E6%A0%B8%E5%BF%83%E7%BB%84%E4%BB%B6IRule"><span class="toc-number">5.3.</span> <span class="toc-text">5.3. Ribbon核心组件IRule</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#5-3-1-Ribbon%E8%B4%9F%E8%BD%BD%E5%9D%87%E8%A1%A1%E7%AE%97%E6%B3%95"><span class="toc-number">5.3.0.1.</span> <span class="toc-text">5.3.1. Ribbon负载均衡算法</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#5-3-2-Ribbon%E8%B4%9F%E8%BD%BD%E5%9D%87%E8%A1%A1%E7%AE%97%E6%B3%95%E4%BD%BF%E7%94%A8%E6%96%B9%E6%B3%95"><span class="toc-number">5.3.0.2.</span> <span class="toc-text">5.3.2. Ribbon负载均衡算法使用方法</span></a></li></ol></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#5-4-%E5%90%8C%E4%B8%80%E4%B8%AA%E9%A1%B9%E7%9B%AE%EF%BC%8C%E5%90%AF%E5%8A%A8%E5%A4%9A%E6%AC%A1-status-port%E5%80%BC%E4%B8%8D%E4%B8%80%E6%A0%B7"><span class="toc-number">5.4.</span> <span class="toc-text">5.4. 同一个项目，启动多次(status,port值不一样)</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#6-%E9%AB%98%E5%8F%AF%E7%94%A8Eureka-Server%E7%8E%AF%E5%A2%83%E6%90%AD%E5%BB%BA"><span class="toc-number">6.</span> <span class="toc-text">6.  高可用Eureka-Server环境搭建</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#-1"><span class="toc-number">7.</span> <span class="toc-text"></span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#-2"><span class="toc-number">8.</span> <span class="toc-text"></span></a></li></ol></div></div></div><div class="card-widget card-map"><div class="card-content"><div class="item-headline"><i class="fa fa-globe-asia" aria-hidden="true"></i><span>访客地图</span></div><script id="clstr_globe" type="text/javascript" defer="defer" src="//clustrmaps.com/globe.js?d=pCztSS3EWdksIfbvbhV92T7cHezjQ5h136R2wDM2N70"></script></div></div></div></main><footer id="footer"><div id="footer-wrap"><div class="copyright">&copy;2021  <i id="heartbeat" class="fa fas fa-heartbeat"></i> Jacky Liu</div><div class="framework-info"><span>框架 </span><a target="_blank" rel="noopener" href="https://hexo.io">Hexo</a><span class="footer-separator">|</span><span>主题 </span><a target="_blank" rel="noopener" href="https://github.com/jerryc127/hexo-theme-butterfly">Butterfly</a></div><div class="footer_custom_text">Hi, welcome to my <a href="https://jackyliu-96.github.io/blog/">blog</a>!</div></div><head><link rel="stylesheet" href="https://cdn.jsdelivr.net/gh/HCLonely/images@master/others/heartbeat.min.css"></head></footer></div><div id="rightside"><div id="rightside-config-hide"><button id="readmode" type="button" title="阅读模式"><i class="fas fa-book-open"></i></button><button id="darkmode" type="button" title="浅色和深色模式转换"><i class="fas fa-adjust"></i></button><button id="hide-aside-btn" type="button" title="单栏和双栏切换"><i class="fas fa-arrows-alt-h"></i></button></div><div id="rightside-config-show"><button id="rightside_config" type="button" title="设置"><i class="fas fa-cog fa-spin"></i></button><button class="close" id="mobile-toc-button" type="button" title="目录"><i class="fas fa-list-ul"></i></button><button id="go-up" type="button" title="回到顶部"><i class="fas fa-arrow-up"></i></button></div></div><div><script src="/blog/js/utils.js"></script><script src="/blog/js/main.js"></script><div class="js-pjax"></div><script async data-pjax src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script></div></body></html>